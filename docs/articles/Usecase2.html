<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CRTspat">
<title>Use Case 2: Simulation of trials with geographical contamination â€¢ CRTspat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Case 2: Simulation of trials with geographical contamination">
<meta property="og:description" content="CRTspat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/CRTspat.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Usecase1.html">Use Case 1: Algorithmic specification of clusters and of buffer zones</a>
    <a class="dropdown-item" href="../articles/Usecase2.html">Use Case 2: Simulation of trials with geographical contamination</a>
    <a class="dropdown-item" href="../articles/Usecase3.html">Use Case 3: Estimation of intracluster correlations (ICC) by cluster size</a>
    <a class="dropdown-item" href="../articles/Usecase4.html">Use Case 4: Estimation of optimal cluster size for a trial with pre-determined buffer width</a>
    <a class="dropdown-item" href="../articles/Usecase5.html">Use Case 5: Analysis of trials (including methods for analysing contamination)</a>
    <a class="dropdown-item" href="../articles/Usecase7.html">Use Case 7: Preparation of datasets for `CRTspat`</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use Case 2: Simulation of trials with geographical contamination</h1>
            
      
      
      <div class="d-none name"><code>Usecase2.Rmd</code></div>
    </div>

    
    
<!--To build the vignette
# since the vignette takes a long time to run, it is not run with every build
# as suggested here https://ropensci.org/blog/2019/12/08/precompute-vignettes/
# to Knit this vignette without this time consuming step being part of the default build
knitr::knit("vignettes/Usecase2.Rmd.orig", output = "vignettes/Usecase2.Rmd")
rmarkdown.html_vignette.check_title = FALSE
devtools::install(build_vignettes = TRUE)
-->
<p>Effects of settlement patterns, choices of cluster size and buffer
widths, and the extent of contamination between arms on the outcomes of
CRTs do not lend themselves to mathematical analysis. Simulations of
trials are used to explore the effects of these variables on trial power
and on the robustness of statistical methodologies.</p>
<p>Trials can be simulated using the <code>simulateCRT</code> function,
which augments a <code>trial</code> data frame (created externally) or
object of class <code>CRTsp</code> (created by package functions) with
simulated outcome data. The input object must be given location
information and both cluster and arm assignments (see <a href="Usecase1.html">Use Case 1</a>) (or the package can generate these
if the objective is purely simulation.</p>
<p>Information about the underlying spatial pattern of disease is used
in the form of the intra-cluster correlation of the outcome, which is
input to the simulation as variable <code>ICC_inp</code>, and of the
<code>propensity</code>. The former takes a single value for the chosen
design. The latter takes a positive real value for each location. In the
case of malaria, <code>propensity</code> can be thought of as measuring
exposure to infectious mosquitoes.</p>
<p><code>ICC_inp</code> and <code>propensity</code> may either be
estimated from other datasets or supplied by the user. The behaviour of
the function depends on which variables are supplied, and the value of
<code>generateBaseline</code>, as follows:</p>
<table class="table">
<colgroup>
<col width="42%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th align="left">Data supplied by the user</th>
<th align="left">Function behaviour</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">
<code>propensity</code> supplied by user</td>
<td align="left">Baseline data are created by sampling around
<code>propensity</code>
</td>
</tr>
<tr class="even">
<td align="left">Baseline data are supplied by user and
<code>propensity</code> is not supplied</td>
<td align="left">
<code>propensity</code> is created from the baseline
data</td>
</tr>
<tr class="odd">
<td align="left">Neither baseline data nor <code>propensity</code> are
supplied</td>
<td align="left">
<code>propensity</code> is generated as a normal
kernel, with the bandwidth adjusted to achieve the input value of the
<code>ICC_inp</code> (after the further smoothing stage to simulate
contamination)</td>
</tr>
</tbody>
</table>
<p>Contamination or spillover between trial arms is modelled as a
additional smoothing process applied to the <code>propensity</code> via
a normal kernel. In the case of malaria this is proposed as an
approximation to the effect of mosquito movement. The degree of
spillover is specified either as a contamination range with the
<code>theta_inp</code> parameter, or as <code>sd</code>, the bandwidth
of the corresponding normal kernel. If both are provided then it is the
value of <code>theta_inp</code> that is used.</p>
<div class="section level4">
<h4 id="example-with-baseline-data-provided-as-proportions">Example with baseline data provided as proportions<a class="anchor" aria-label="anchor" href="#example-with-baseline-data-provided-as-proportions"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CRTspat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">example_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">'example_site.csv'</span><span class="op">)</span></span>
<span><span class="va">example_locations</span><span class="op">$</span><span class="va">base_denom</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">example_randomized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">example_locations</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/aggregateCRT.html">aggregateCRT</a></span><span class="op">(</span>auxiliaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RDT_test_result"</span>, <span class="st">"base_denom"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">50</span>, algorithm <span class="op">=</span> <span class="st">'NN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>matchedPair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example_randomized</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##         Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x -3.20    -1.40    -0.30    -0.07     1.26     5.16   </span></span>
<span><span class="co">##       y -5.08    -2.84     0.19     0.05     2.49     6.16   </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  27.6 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -            </span></span>
<span><span class="co">## Coordinate system                      (x, y)            </span></span>
<span><span class="co">## Locations:                                                      1181            </span></span>
<span><span class="co">## Available clusters (across both arms)                           24            </span></span>
<span><span class="co">##   Per cluster mean number of points                             49.2            </span></span>
<span><span class="co">##   Per cluster s.d. number of points                             3.9            </span></span>
<span><span class="co">## S.D. of distance to nearest discordant location (km):           1.05          </span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized            </span></span>
<span><span class="co">## No power calculations to report          -            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          RDT_test_result  base_denom</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example_randomized</span>, map <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">example2a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span><span class="va">example_randomized</span>,</span>
<span>       effect <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>       outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>       generateBaseline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       baselineNumerator <span class="op">=</span> <span class="st">"RDT_test_result"</span>,</span>
<span>       baselineDenominator <span class="op">=</span> <span class="st">"base_denom"</span>,</span>
<span>       ICC_inp <span class="op">=</span> <span class="cn">NULL</span>, theta_inp <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## =====================    SIMULATION OF CLUSTER RANDOMISED TRIAL    =================</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example2a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##         Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x -3.20    -1.40    -0.30    -0.07     1.26     5.16   </span></span>
<span><span class="co">##       y -5.08    -2.84     0.19     0.05     2.49     6.16   </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  27.6 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -            </span></span>
<span><span class="co">## Coordinate system                      (x, y)            </span></span>
<span><span class="co">## Locations:                                                      1181            </span></span>
<span><span class="co">## Available clusters (across both arms)                           24            </span></span>
<span><span class="co">##   Per cluster mean number of points                             49.2            </span></span>
<span><span class="co">##   Per cluster s.d. number of points                             3.9            </span></span>
<span><span class="co">## S.D. of distance to nearest discordant location (km):           1.05          </span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized            </span></span>
<span><span class="co">## No power calculations to report          -            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          RDT_test_result  base_denom  propensity  denom  num</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org/" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="va">examplemesh100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readdata.html">readdata</a></span><span class="op">(</span><span class="st">"examplemesh100.txt"</span><span class="op">)</span></span>
<span><span class="va">example2aanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span>trial<span class="op">=</span><span class="va">example2a</span>, method <span class="op">=</span> <span class="st">'T'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example2aanalysis</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  T </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Model formula:  arm + (1 | cluster) </span></span>
<span><span class="co">## No modelling of contamination </span></span>
<span><span class="co">## Estimates:     Control:  0.364  (95% CL:  0.286 0.451 )</span></span>
<span><span class="co">##           Intervention:  0.21  (95% CL:  0.147 0.292 )</span></span>
<span><span class="co">##              Efficacy:   0.423  (95% CL:  0.208 0.727 )</span></span>
<span><span class="co">## Percentage of population in contamination zone:  0 %</span></span>
<span><span class="co">## P-value (2-sided):  0.006879</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example2aINLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span>trial<span class="op">=</span><span class="va">example2a</span>,</span>
<span>                                 method <span class="op">=</span> <span class="st">'INLA'</span>, link<span class="op">=</span><span class="st">'logit'</span>, cfunc <span class="op">=</span> <span class="st">'X'</span>,</span>
<span>                                 clusterEffects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 requireMesh <span class="op">=</span> <span class="cn">TRUE</span>, inla_mesh <span class="op">=</span> <span class="va">examplemesh100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example2aINLA</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example2aINLA</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'prediction'</span>, showClusterBoundaries <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example2a.r-1.png"><br><em>Fig 2.1 Map of simulated outcome
at cluster level</em>
</p>
<p>
<img src="example2a.r-2.png"><br><em>Fig 2.2 Variation in outcome by
distance from boundary</em>
</p>
</div>
<div class="section level4">
<h4 id="example-with-infectiousness-proxy-surface-generated-externally">Example with infectiousness proxy surface generated externally<a class="anchor" aria-label="anchor" href="#example-with-infectiousness-proxy-surface-generated-externally"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># Simulate a site with 2000 locations</span></span>
<span><span class="va">new_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span>geoscale <span class="op">=</span> <span class="fl">2</span>, locations<span class="op">=</span><span class="fl">2000</span>, kappa<span class="op">=</span><span class="fl">3</span>, mu<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span><span class="co"># propensity surface generated as an arbitrary linear function of x the co-ordinate</span></span>
<span><span class="va">new_site</span><span class="op">$</span><span class="va">propensity</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">new_site</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">new_site</span><span class="op">$</span><span class="va">trial</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span>
<span><span class="va">example2b</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span><span class="va">new_site</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">40</span>, algorithm <span class="op">=</span> <span class="st">'NN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>matchedPair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span><span class="va">example_simulated</span>,</span>
<span>                          effect <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                          outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                          generateBaseline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          ICC_inp <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                          theta_inp <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">example2b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ===============================CLUSTER RANDOMISED TRIAL ===========================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of coordinates</span></span>
<span><span class="co">## ----------------------</span></span>
<span><span class="co">##         Min.   : 1st Qu.: Median : Mean   : 3rd Qu.: Max.   :</span></span>
<span><span class="co">##       x -8.73    -5.16    -1.03     0.00     5.17    11.26   </span></span>
<span><span class="co">##       y -9.55    -4.42    -0.58     0.00     4.56    10.45   </span></span>
<span><span class="co">## Total area (within  0.2 km of a location) :  181 sq.km</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Locations and Clusters</span></span>
<span><span class="co">## ----------------------                                          -            </span></span>
<span><span class="co">## Coordinate system                      (x, y)            </span></span>
<span><span class="co">## Locations:                                                      2000            </span></span>
<span><span class="co">## Available clusters (across both arms)                           50            </span></span>
<span><span class="co">##   Per cluster mean number of points                             40            </span></span>
<span><span class="co">##   Per cluster s.d. number of points                             0            </span></span>
<span><span class="co">## S.D. of distance to nearest discordant location (km):           1.33          </span></span>
<span><span class="co">## Cluster randomization:                      Independently randomized            </span></span>
<span><span class="co">## No power calculations to report          -            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Other variables in dataset</span></span>
<span><span class="co">## --------------------------          propensity  base_denom  base_num  denom  num</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">example2b</span>, method <span class="op">=</span> <span class="st">'GEE'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results2b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  GEE </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Model formula:  arm </span></span>
<span><span class="co">## No modelling of contamination </span></span>
<span><span class="co">## Estimates:     Control:  0.372  (95% CL:  0.319 0.428 )</span></span>
<span><span class="co">##           Intervention:  0.228  (95% CL:  0.192 0.269 )</span></span>
<span><span class="co">##              Efficacy:   0.387  (95% CL:  0.233 0.511 )</span></span>
<span><span class="co">## Percentage of population in contamination zone:  0 %</span></span>
<span><span class="co">## Intracluster correlation (ICC):  0.0454  (95% CL:  0.0202 0.0706 )</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCRT.html">plotCRT</a></span><span class="op">(</span><span class="va">example2b</span>, map <span class="op">=</span> <span class="cn">TRUE</span>, fill <span class="op">=</span> <span class="st">'clusters'</span>, showClusterLabels <span class="op">=</span> <span class="cn">TRUE</span>, maskbuffer <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>
<img src="example2b.r-1.png"><br><em>Fig 2.3 Map of clusters in
simulated trial</em>
</p>
</div>
<div class="section level4">
<h4 id="example-with-baseline-generated-from-user-provided-values-of-the-overall-initial-prevalence-and-icc">Example with baseline generated from user-provided values of the
overall initial prevalence and ICC<a class="anchor" aria-label="anchor" href="#example-with-baseline-generated-from-user-provided-values-of-the-overall-initial-prevalence-and-icc"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># use co-ordinates, cluster and arm assignments, and baseline data from `example_simulated`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span></span>
<span><span class="va">example2c</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTsp.html">CRTsp</a></span><span class="op">(</span>geoscale <span class="op">=</span> <span class="fl">2</span>, locations<span class="op">=</span><span class="fl">2000</span>, kappa<span class="op">=</span><span class="fl">3</span>, mu<span class="op">=</span><span class="fl">40</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/specify_clusters.html">specify_clusters</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">40</span>, algorithm <span class="op">=</span> <span class="st">'NN'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/randomizeCRT.html">randomizeCRT</a></span><span class="op">(</span>matchedPair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/simulateCRT.html">simulateCRT</a></span><span class="op">(</span><span class="va">new_site</span>,</span>
<span>       effect <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>       outcome0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>       generateBaseline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       baselineNumerator <span class="op">=</span> <span class="st">'base_num'</span>,</span>
<span>       baselineDenominator <span class="op">=</span> <span class="st">'base_denom'</span>,</span>
<span>       ICC_inp <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>       theta_inp <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">results2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CRTanalysis.html">CRTanalysis</a></span><span class="op">(</span><span class="va">example2c</span>, method <span class="op">=</span> <span class="st">'GEE'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">results2c</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## =====================CLUSTER RANDOMISED TRIAL ANALYSIS =================</span></span>
<span><span class="co">## Analysis method:  GEE </span></span>
<span><span class="co">## Link function:  logit </span></span>
<span><span class="co">## Model formula:  arm </span></span>
<span><span class="co">## No modelling of contamination </span></span>
<span><span class="co">## Estimates:     Control:  0.317  (95% CL:  0.26 0.381 )</span></span>
<span><span class="co">##           Intervention:  0.283  (95% CL:  0.23 0.343 )</span></span>
<span><span class="co">##              Efficacy:   0.107  (95% CL:  -0.184 0.317 )</span></span>
<span><span class="co">## Percentage of population in contamination zone:  0 %</span></span>
<span><span class="co">## Intracluster correlation (ICC):  0.0834  (95% CL:  0.0503 0.117 )</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
