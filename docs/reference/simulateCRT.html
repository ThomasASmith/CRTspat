<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="simulateCRT generates simulated data for a cluster randomized trial (CRT) with geographic contamination between arms."><title>Simulation of cluster randomized trial with contamination — simulateCRT • CRTspat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation of cluster randomized trial with contamination — simulateCRT"><meta property="og:description" content="simulateCRT generates simulated data for a cluster randomized trial (CRT) with geographic contamination between arms."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CRTspat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/CRTspat.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Usecase1.html">Use Case 1: Algorithmic specification of clusters and of buffer zones</a>
    <a class="dropdown-item" href="../articles/Usecase2.html">Use Case 2: Simulation of trials with geographical contamination</a>
    <a class="dropdown-item" href="../articles/Usecase3.html">Use Case 3: Estimation of intracluster correlations (ICC) by cluster size</a>
    <a class="dropdown-item" href="../articles/Usecase4.html">Use Case 4: Estimation of optimal cluster size for a trial with pre-determined buffer width</a>
    <a class="dropdown-item" href="../articles/Usecase5.html">Use Case 5: Analysis of trials (including methods for analysing contamination)</a>
    <a class="dropdown-item" href="../articles/Usecase7.html">Use Case 7: Preparation of datasets for `CRTspat`</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulation of cluster randomized trial with contamination</h1>
      
      <div class="d-none name"><code>simulateCRT.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>simulateCRT</code> generates simulated data for a cluster randomized trial (CRT) with geographic contamination between arms.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simulateCRT</span><span class="op">(</span></span>
<span>  trial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  effect <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  outcome0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  generateBaseline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  matchedPair <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"proportion"</span>,</span>
<span>  baselineNumerator <span class="op">=</span> <span class="st">"base_num"</span>,</span>
<span>  baselineDenominator <span class="op">=</span> <span class="st">"base_denom"</span>,</span>
<span>  denominator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ICC_inp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  theta_inp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  vr <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>trial</dt>
<dd><p>an object of class <code>"CRTsp"</code> or a data frame containing locations in (x,y) coordinates, cluster
assignments (factor <code>cluster</code>), and arm assignments (factor <code>arm</code>). Each location may also be
assigned a <code>propensity</code> (see details).</p></dd>


<dt>effect</dt>
<dd><p>numeric. The simulated effect size (defaults to 0)</p></dd>


<dt>outcome0</dt>
<dd><p>numeric. The anticipated value of the outcome in the absence of intervention</p></dd>


<dt>generateBaseline</dt>
<dd><p>logical. If <code>TRUE</code> then baseline data will be simulated</p></dd>


<dt>matchedPair</dt>
<dd><p>logical. If <code>TRUE</code> then the function tries to carry out randomization
using pair-matching on the baseline data (see details)</p></dd>


<dt>scale</dt>
<dd><p>measurement scale of the outcome. Options are: 'proportion' (the default); 'count'; 'continuous'.</p></dd>


<dt>baselineNumerator</dt>
<dd><p>optional name of numerator variable for baseline data</p></dd>


<dt>baselineDenominator</dt>
<dd><p>optional name of denominator variable for baseline data</p></dd>


<dt>denominator</dt>
<dd><p>optional name of denominator variable for the outcome</p></dd>


<dt>ICC_inp</dt>
<dd><p>numeric. Target intra cluster correlation, provided as input when baseline data are to be simulated</p></dd>


<dt>sd</dt>
<dd><p>numeric. standard deviation of the normal kernel measuring spatial smoothing leading to contamination</p></dd>


<dt>theta_inp</dt>
<dd><p>numeric. input contamination range</p></dd>


<dt>tol</dt>
<dd><p>numeric. tolerance of output ICC</p></dd>


<dt>vr</dt>
<dd><p>numeric. ratio of location variance to cluster variance (for continuous outcomes)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of class <code>"CRTsp"</code> containing the following components:</p><table class="table table"><tr><td><code>geom_full</code></td><td>list:</td><td>summary statistics describing the site
cluster assignments, and randomization</td><td></td></tr><tr><td><code>design</code></td><td>list:</td><td>values of input parameters to the design</td><td></td></tr><tr><td><code>trial</code></td><td>data frame:</td><td>rows correspond to geolocated points, as follows:</td><td></td></tr><tr><td></td><td><code>x</code></td><td>numeric vector:</td><td>x-coordinates of locations</td></tr><tr><td></td><td><code>y</code></td><td>numeric vector:</td><td>y-coordinates of locations</td></tr><tr><td></td><td><code>cluster</code></td><td>factor:</td><td>assignments to cluster of each location</td></tr><tr><td></td><td><code>arm</code></td><td>factor:</td><td>assignments to <code>control</code> or <code>intervention</code> for each location</td></tr><tr><td></td><td><code>nearestDiscord</code></td><td>numeric vector:</td><td>Euclidean distance to nearest discordant location (km)</td></tr><tr><td></td><td><code>propensity</code></td><td>numeric vector:</td><td>propensity of location</td></tr><tr><td></td><td><code>base_denom</code></td><td>numeric vector:</td><td>denominator for baseline</td></tr><tr><td></td><td><code>base_num</code></td><td>numeric vector:</td><td>numerator for baseline</td></tr><tr><td></td><td><code>denom</code></td><td>numeric vector:</td><td>denominator for the outcome</td></tr><tr><td></td><td><code>num</code></td><td>numeric vector:</td><td>numerator for the outcome</td></tr><tr><td></td><td><code>...</code></td><td></td><td>other objects included in the input <code>"CRTsp"</code> object
or <code>data.frame</code></td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Synthetic data are generated by sampling around the values of
variable <code>propensity</code>, which is a numerical vector
(taking positive values) of length equal to the number of locations.
There are three ways in which <code>propensity</code> can arise:</p><ol><li><p><code>propensity</code> can be provided as part of the input <code>trial</code> object.</p></li>
<li><p>Baseline numerators and denominators (values of <code>baselineNumerator</code>
and <code>baselineDenominator</code> may be provided.
<code>propensity</code> is then generated as the numerator:denominator ratio
for each location in the input object</p></li>
<li><p>Otherwise <code>propensity</code> is generated using a 2D Normal
kernel density. The <a href="https://rdrr.io/cran/OOR/man/StoSOO.html" class="external-link"><code><a href="https://rdrr.io/pkg/OOR/man/StoSOO.html" class="external-link">OOR::StoSOO</a></code></a>
is used to achieve an intra-cluster correlation coefficient (ICC) that approximates
the value of <code>'ICC_inp'</code> by searching for an appropriate value of the kernel bandwidth.</p></li>
</ol><p><code>num[i]</code>, the synthetic outcome for location <code>i</code>
is simulated with expectation: <br>
$$\code{E(num[i]) = outcome0[i] * propensity[i] * denom[i] * (1 - effect*I[i])/mean(outcome0[] * propensity[])}$$ <br>
The sampling distribution of <code>num[i]</code> depends on the value of <code>scale</code> as follows: <br></p><table class="table table"><tr><td><code>scale</code>=’continuous’</td><td>Values of <code>num</code> are sampled from a
Normal distributions with means <code>E(num[i])</code>
and variance determined by <code>vr</code> and the fitting to <code>ICC_inp</code>.</td><td><code>scale</code>=’count’</td><td>Simulated events are allocated to locations via multivariate hypergeometric distributions
parameterised with <code>E(num[i])</code>.</td></tr></table><p><code>denominator</code> may specify a vector of numeric (non-zero) values
in the input <code>"CRTsp"</code> or <code>data.frame</code> which is returned
as variable <code>denom</code>. It acts as a scale-factor for continuous outcomes, rate-multiplier
for counts, or denominator for proportions. For discrete data all values of <code>denom</code>
must be &gt; 0.5 and are rounded to the nearest integer in calculations of <code>num</code>.<br><br>
By default, <code>denom</code> is generated as a vector of ones, leading to simulation of
dichotomous outcomes if <code>scale</code>=’proportion’.<br></p>
<p>If baseline numerators and denominators are provided then the output vectors
<code>base_denom</code> and  <code>base_num</code> are set to the input values. If baseline numerators and denominators
are not provided then the synthetic baseline data are generated by sampling around <code>propensity</code> in the same
way as the outcome data, but with the effect size set to zero.</p>
<p>If <code>matchedPair</code> is <code>TRUE</code> then pair-matching on the baseline data will be used in randomization providing
there are an even number of clusters. If there are an odd number of clusters then matched pairs are not generated and
an unmatched randomization is output.</p>
<p>Either <code>sd</code> or <code>theta_inp</code> must be provided. If both are provided then
the value of <code>sd</code> is overwritten
by the standard deviation implicit in the value of <code>theta_inp</code>.
Contamination is simulated as arising from a diffusion-like process.</p>
<p>For further details see <a href="https://edoc.unibas.ch/85228/" class="external-link">Multerer (2021)</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">example_simulated_CRT</span> <span class="op">=</span>  <span class="fu">simulateCRT</span><span class="op">(</span>trial<span class="op">=</span><span class="fu"><a href="readdata.html">readdata</a></span><span class="op">(</span><span class="st">'exampleCRT.csv'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                     effect<span class="op">=</span><span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>                                     ICC_inp<span class="op">=</span><span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>                                     outcome0<span class="op">=</span><span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                                     matchedPair <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                                     scale<span class="op">=</span><span class="st">'proportion'</span>,</span></span>
<span class="r-in"><span>                                     sd<span class="op">=</span><span class="fl">0.6</span>,</span></span>
<span class="r-in"><span>                                     tol<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =====================    SIMULATION OF CLUSTER RANDOMISED TRIAL    =================</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Thomas Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

