---
title: "Use Case 7: Preparation of datasets for `CRTspat`"
output:
  rmarkdown::html_vignette:
  toc: true
vignette: >
  %\VignetteIndexEntry{Use Case 7: Preparation of datasets for `CRTspat`}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<!--To build the vignette
# since the vignette takes a long time to run, it is not run with every build
# as suggested here https://ropensci.org/blog/2019/12/08/precompute-vignettes/
# to Knit this vignette without this time consuming step being part of the default build
knitr::knit("vignettes/Usecase7.Rmd.orig", output = "vignettes/Usecase7.Rmd")
rmarkdown.html_vignette.check_title = FALSE
devtools::install(build_vignettes = TRUE)
-->

The starting point for the analyses is the co-ordinates for the spatial units that are to be randomized. These can be provided as lat-long coordinates, or as Cartesian point co-ordinates. Geolocated data from completed field studies or trials in progress can be read into `CRTspat` in the form of data frames, preferably with one record for each location in the trial. Pre-existing data from the field should be
coded as follows:

| Description of variable    | Variable name | Type and values                                            |
|----------------------------|---------------|-------------------------------------------------|
| x-coordinates of locations | x             | Numeric                                         |
| x-coordinates of locations | y             | Numeric                                         |
| cluster assignment         | cluster       | factor                                          |
| arm assignment             | arm           | factor with levels "Control" and "Intervention" |
| buffer assignment          | buffer        | logical (TRUE for locations in the buffer)      |

Users might want to include an ID variable in the data frame if they intend to link the outputs back to other
datasets. Other variables, including baseline data or trial outcomes may also be included.

| Description of variable    | Default Variable name | Type        |
|----------------------------|---------------|-------------|
| Baseline numerator | base_num             | Numeric      |
| Baseline denominator | base_denom             | Numeric  |
| Numerator | num             | Numeric                    |
| Denominator | denom             | Numeric                |

Simulated co-ordinate sets can also be generated *de novo* (function [`CRTsp()`](../reference/CRTsp.html)) for use in methods development and testing.

To make it possible to share data files without compromising confidentiality the [`anonymize.site()`](../reference/anonymize_site.html) function is provided. This removes absolute geolocations and applies a transformation to the coordinates to conserve distances between them but modifying the orientation.

The [`latlong_as_xy`](../reference/latlong_as_xy.html) function is available to convert co-ordinates provided as decimal degrees into Cartesian co-ordinates with units of km with centroid (0,0). If the input co-ordinates are provided using a different projection then they must be converted externally to the package.

The [`writeCRT`](../reference/writeCRT.html)] function exports simple features objects created within `CRTspat`
(using functions from the `sf` package) to GIS files. This uses the [`sf::st_write()`](https://r-spatial.github.io/sf/articles/sf2.html) function which
`writeCRT` attempts to assign an appropriate co-ordinate reference system (`crs`) to the exported object. By default `crs` is assigned the WGS1984 coordinate reference system is used, with the centroid location recorded in the `CRTspat` or `CRTanalysis` object used to
compute the geolocations. If the dataset has been anonymised then it has no coordinate reference system and is
exported using the Cartesian coordinates.

